<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>How to repackage a Vagrant Box | Bill’s Random Notes</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="How to repackage a Vagrant Box" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="SSH into the Box and Customize It" />
<meta property="og:description" content="SSH into the Box and Customize It" />
<link rel="canonical" href="http://localhost:4000/vagrant/2017/05/14/Repackage-vagrant-box.html" />
<meta property="og:url" content="http://localhost:4000/vagrant/2017/05/14/Repackage-vagrant-box.html" />
<meta property="og:site_name" content="Bill’s Random Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-05-14T18:18:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to repackage a Vagrant Box" />
<script type="application/ld+json">
{"url":"http://localhost:4000/vagrant/2017/05/14/Repackage-vagrant-box.html","headline":"How to repackage a Vagrant Box","dateModified":"2017-05-14T18:18:00+01:00","datePublished":"2017-05-14T18:18:00+01:00","description":"SSH into the Box and Customize It","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/vagrant/2017/05/14/Repackage-vagrant-box.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Bill's Random Notes" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Bill&#39;s Random Notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/links/">Links</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to repackage a Vagrant Box</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-05-14T18:18:00+01:00" itemprop="datePublished">May 14, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="ssh-into-the-box-and-customize-it">SSH into the Box and Customize It</h2>

<p>We’ll now SSH into the box and start customizing it. If you don’t know anything about servers,
you can always just use Scotch Box since all of this is already done for you. Here’s how to SSH into the box:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh
</code></pre></div></div>

<p>Now, we need to setup our server by installing whatever we want on it. This example will install a basic LAMP stack,
but you can do whatever you like (Ruby, Nginx, etc.). The point of this article isn’t to teach you how to setup a server,
but instead how to turn your virtual environment into a Vagrant Box. So this step might be more involved than what is actually shown:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get upgrade
sudo apt-get install vim
sudo apt-get install apache2
sudo apt-get install mysql-server libapache2-mod-auth-mysql php5-mysql
sudo mysql_install_db
sudo /usr/bin/mysql_secure_installation
sudo apt-get install php5 libapache2-mod-php5 php5-mcrypt
sudo apt-get install php5-cgi php5-cli php5-curl php5-common php5-gd php5-mysql
sudo service apache2 restart
</code></pre></div></div>
<h2 id="make-the-box-as-small-as-possible">Make the Box as Small as possible</h2>

<p>We’re now going to clean up disk space on the VM so when we package it into a new Vagrant box,
it’s as clean as possible. First, remove APT cache</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get clean
</code></pre></div></div>
<p>Then, “zero out” the drive (this is for Ubuntu):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dd if=/dev/zero of=/EMPTY bs=1M
sudo rm -f /EMPTY
</code></pre></div></div>
<p>Lastly, let’s clear the Bash History and exit the VM:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /dev/null &gt; ~/.bash_history &amp;&amp; history -c &amp;&amp; exit
</code></pre></div></div>
<h2 id="repackage-the-vm-into-a-new-vagrant-box">Repackage the VM into a New Vagrant Box</h2>

<p>We’re now going to repackage the server we just created into a new Vagrant Base Box. It’s very easy with Vagrant:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant package --output mynew.box
</code></pre></div></div>
<h2 id="add-the-box-into-your-vagrant-install">Add the Box into Your Vagrant Install</h2>

<p>The previous command will have created a “mynew.box” file. You can technically put this wherever you want on your computer. Now, let’s add this new Vagrant Box into Vagrant:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant box add mynewbox mynew.box
</code></pre></div></div>
<p>This now will “download” the box into your Vagrant install allowing to initiate this from any folder, but before we do this, let’s delete and remove the Vagrant file we built this box from.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant destroy
rm Vagrantfile
</code></pre></div></div>
<h2 id="initialize-your-new-vagrant-box">Initialize Your New Vagrant Box</h2>

<p>We need to now initialize a Vagrant environment from our brand new box using the same command from earlier but referencing the new Box.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant init mynewbox
</code></pre></div></div>

  </div><a class="u-url" href="/vagrant/2017/05/14/Repackage-vagrant-box.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Bill&#39;s Random Notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Bill&#39;s Random Notes</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/billjinks"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">billjinks</span></a></li><li><a href="https://www.twitter.com/billjinks"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">billjinks</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Not much to see here, just a few notes from various hobby projects I do from time to time.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
